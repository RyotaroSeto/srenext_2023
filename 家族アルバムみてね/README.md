# 1,800 万人が利用する『家族アルバム みてね』における K8s 基盤のアップグレード戦略と継続的改善

https://sre-next.dev/2023/schedule/#jp093
https://speakerdeck.com/kohbis/familyalbum-release-flow-on-eks

- k8s は年に３回マイナーバージョンリリース&12 ヶ月サポート
- EKS はマイネーバーションのリリースから 14 ヶ月サポート

### EKS クラスタの blue/Green による無停止アップグレード

- 複数リージョンに EKS クラスタ存在
- ALB の加重ルーティングで徐々にトラフィック移行

## EKS アップグレードで発生する作業

### 新しいバージョン EKS クラスタアップデート作業

- アップグレード手順を確立する
- 実施、問題やつまづき、手順に反映、自動化の繰り返す
- ArgoCD の手動インストール
  - Helm による手動インストール。
  - シェルスクリプトに落としてスクリプト化した！
- EKS クラスタバージョンアップグレードのたびに ArgoCD インストールは毎回同じ作業
  - ops クラスタとみてクラスタの EKS クラスタを分割することにした
  - argo は ops クラスタでのみ存在させるようにした

### 今後改善したいこと

- ops クラスタのインプレースアップグレードの対応
- helm コードのリファクタリング
- Helm Chart の継続的メンテナンス
- さらなる自動化
